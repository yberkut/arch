# LVM Snapshot CheatSheet

### **Основні команди**

#### **1. Створення снапшоту**

```bash
sudo lvcreate -L<size> -s -n <snapshot_name> /dev/<vg_name>/<lv_name>
```

- `<size>` – розмір снапшоту (залежить від обсягу можливих змін)
- `<snapshot_name>` – назва снапшоту
- `<vg_name>` – ім'я групи томів (Volume Group)
- `<lv_name>` – ім'я логічного тому (Logical Volume), який бекапимо

**Приклад:**

```bash
sudo lvcreate -L20G -s -n root-snap /dev/vg0/root
```

#### **2. Перегляд списку снапшотів**

```bash
sudo lvs
```

Або для детальнішої інформації:

```bash
sudo lvdisplay
```

#### **3. Відновлення системи зі снапшоту**

```bash
sudo lvconvert --merge /dev/<vg_name>/<snapshot_name>
```

**Приклад:**

```bash
sudo lvconvert --merge /dev/vg0/root-snap
```

> ⚠️ Відновлення працює після перезавантаження системи!

#### **4. Видалення снапшоту**

```bash
sudo lvremove /dev/<vg_name>/<snapshot_name>
```

**Приклад:**

```bash
sudo lvremove /dev/vg0/root-snap
```

#### **5. Перевірка стану снапшоту**

```bash
sudo lvs --options +devices
```

Показує `Data%`, який вказує, скільки місця вже використано.

#### **6. Перегляд доступного вільного місця у VG**

```bash
sudo vgs
```

#### **7. Розширення LVM, якщо не вистачає місця**

- Якщо у групі томів (`vg`) є вільне місце:

```bash
sudo lvextend -L+<size> /dev/<vg_name>/<lv_name>
```

- Якщо в групі томів немає вільного місця, потрібно додати фізичний диск або зменшити інший LV.

### **Як працюють снапшоти LVM**

- Снапшот НЕ містить повної копії даних, а лише відстежує зміни.
- Спочатку займає **0% простору**, потім росте по мірі змін у вихідному томі.
- Якщо снапшот переповниться – він автоматично стає непридатним.

### **Стратегія використання**

1. **Перед великими оновленнями:** створювати снапшот і повертатися, якщо щось піде не так.
2. **Автоматичні резервні копії:** періодичне створення снапшотів + відправка в `restic` або `rsync`.
3. **Моніторинг вільного місця в снапшотах:** щоб вони не переповнилися.
